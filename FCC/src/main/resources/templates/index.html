{{>layout/header}}
<style>
	#ingreInfoDetail {
		display: none;
	}
</style>

<body>
	<!-- Preloader -->
	<div class="preloader">
		<img src="/images/logos/favicon.ico" alt="loader" class="lds-ripple img-fluid" />
	</div>
	<!-- Body Wrapper -->
	<div class="page-wrapper" id="main-wrapper" data-layout="horizontal" data-navbarbg="skin6" data-sidebartype="full"
		data-sidebar-position="fixed" data-header-position="fixed">
		{{>layout/nav}}
		<div class="body-wrapper">
			<div class="container-fluid">
				<!--  Owl carousel -->
				<h3 class="card-title mb-9 fw-semibold">TastyTales's Pickâœ¨</h3> <br />
				<div class="owl-carousel counter-carousel owl-theme">
					{{#list}}
					<div class="item">
						<div class="card border-0 zoom-in bg-light-primary shadow-none">
							<div class="card-body">
								<div class="text-center">
									<img src="{{rcp_img_s}}" width="100" height="100" class="mb-3" alt="" />
									<p class="fw-semibold fs-3 text-primary mb-1"
										style="max-width: 300px; max-height: 300px; overflow: hidden; text-overflow: ellipsis; white-space: normal;">
										{{rcp_name}}</p>
								</div>
							</div>
						</div>
					</div>
					{{/list}}
				</div>

				<div class="row">
					<div class="col-lg-8 d-flex align-items-strech">
						<div class="card w-100">
							<div class="card-body">
								<div class="d-sm-flex d-block align-items-center justify-content-between mb-9">
									<div class="mb-3 mb-sm-0" id="frigoLink">
										<h5 class="card-title fw-semibold">{{logInfo.mem_nickname}}ë‹˜â—ìœ í†µê¸°í•œ ìˆœìœ¼ë¡œ ì •ë¦¬í•´ë“œë¦´ê²Œìš”ğŸ’•
										</h5>
									</div>
									<div>
										<select class="form-select" id="fridge_select">
											<option value="ëƒ‰ì¥" selected>ëƒ‰ì¥ê³ </option>
											<option value="ëƒ‰ë™">ëƒ‰ë™ê³ </option>
											<option value="ì‹¤ì˜¨">ì‹¤ì˜¨ë³´ê´€</option>
										</select>
									</div>
								</div>

								<div id="fridgeInfo">
									<!-- ëƒ‰ì¥ê³  ë‚´ìš©ì„ ì—¬ê¸°ì— í‘œì‹œ -->
								</div>

							</div>
						</div>
					</div>
					<div class="col-lg-4">
						<div class="row">
							<div class="col-lg-12 col-md-6 col-sm-12">

								<!-- ì‹í’ˆ ì˜ì–‘ ì •ë³´ -->
								<div class="card overflow-hidden">
									<div class="card-body">
										<div class="row align-items-center">
											<div class="col-5">
												<div id="nutritionInfoPlaceholder">
													<h5 class="card-title mb-9 fw-semibold">ì¬ë£Œë¥¼ í´ë¦­í•˜ì—¬ ì˜ì–‘ ì„±ë¶„ì„ í™•ì¸í•˜ì„¸ìš”</h5>
												</div>
												<h5 class="card-title mb-9 fw-semibold"><span id="ingreName"> </span>
												</h5>
												<div id="ingreInfoDetail">
													<class="card-title mb-9 fw-semibold"> ë‹¨ë°±ì§ˆ : <span id="ingrePro"></span> </class><br />
													<class="card-title mb-9 fw-semibold"> íƒ„ìˆ˜í™”ë¬¼ : <span id="ingreCar"> </span> </class><br />
													<class="card-title mb-9 fw-semibold"> ì§€ë°© : <span id="ingreFat"> </span> </class><br />
												</div>
											</div>

											<div class="col-6">
												<div class="d-flex justify-content-center">
													<!-- ì°¨íŠ¸ -->
													<div class="card-body">
														<canvas id="nutritionChart"></canvas>
													</div>
													<!-- //ì°¨íŠ¸ -->
												</div>
											</div>
										</div>
									</div>
								</div>
								<!-- // ì‹í’ˆ ì˜ì–‘ ì •ë³´ -->
							</div>

							<!-- ëƒ‰ì¥ê³  ì‹ ì„ ë„ -->
							<div class="card">
								<div class="card-body">
									<div class="row alig n-items-start">
										<h5 class="card-title mb-9 fw-semibold"> ëƒ‰ì¥ê³  ì‹ ì„ ë„ </h5>
										<!-- í”„ë¡œê·¸ë˜ìŠ¤ë°”-->
										<div class="progress" style="height: 25px;">
											<div id="progressbar" class="progress-bar bg-empty" role="progressbar">
												<span id="progressbarStatus"></span>
											</div>
										</div>
										<!--// í”„ë¡œê·¸ë˜ìŠ¤ë°”-->
									</div>
								</div>
							</div>
							<!-- //ëƒ‰ì¥ê³  ì‹ ì„ ë„ -->

						</div>
					</div>
				</div>
			</div>
			<!-- //row1 -->
		</div>
	</div>
	{{>layout/mobile_nav}}
	<script src="/libs/jquery/dist/jquery.min.js"></script>
	<script src="/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script> 		<!-- í”„ë¡œí•„ ë“œë¡­ ë‹¤ìš´ -->
	
	<script src="/js/app-style-switcher.js"></script>
	<script src="/js/custom.js"></script>
	<script src="/libs/owl.carousel/dist/owl.carousel.min.js"></script>
	<script src="/js/dashboard.js"></script>
</body>

</html>

<script>
	let mem_seq = '{{logInfo.mem_seq}}';
	console.log(mem_seq);
	// document.ready
	$(() => {
		// ëƒ‰ì¥ê³  ì´ˆê¸° ì„¤ì •
		let initialSelectedValue = $("#fridge_select").val();
		fetchData(initialSelectedValue);

		// ì„ íƒëœ storage
		$("#fridge_select").change(function () {
			let selectedValue = $(this).val();

			// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ê¸°ë³¸ê°’: ëƒ‰ì¥ê³ )
			let initialSelectedValue = $("#fridge_select").val();
			fetchData(initialSelectedValue);
		});

		// ì°¨íŠ¸ ë°ì´í„° ì´ˆê¸°í™”
		nutritionChart.data.datasets[0].data = [33, 33, 33];
		nutritionChart.update();

		// í”„ë¡œê·¸ë˜ìŠ¤ë°”
		updateProgressBar();

	});

	// TastyTales's Pickâœ¨ í…ìŠ¤íŠ¸ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
	$(".card-title.mb-9.fw-semibold").on("click", function () {
		window.location.href = "/recipe/list";
	});

	// ë‚´ ëƒ‰ì¥ê³  ìš”ì•½ í´ë¦­ ì‹œ my_frigo.htmlë¡œ ì´ë™
	$("#frigoLink").on("click", function () {
		// í˜ì´ì§€ ì´ë™
		window.location.href = "/my_frigo";
	});

	// ëƒ‰ì¥ê³  ì…€ë ‰íŠ¸ ë°•ìŠ¤
	function fetchData(selectedValue) {
		$.ajax({
			url: "/index/refigoInfo",
			data: {frigo_storage: selectedValue, mem_seq: mem_seq},
			dataType: "json",
			method: "post"
		})
			.done((res) => {
				if (res.result == "success") {
					let result = res.list;
					let temp = "";
					if (result.length === 0) {
						temp = "<p style='text-align: center; font-size: 24px; font-weight: bold;'> <br /> <br /> <br />ë¹„ì–´ìˆìŠµë‹ˆë‹¤ <br /> ë‚˜ì˜ ëƒ‰ì¥ê³ ì—ì„œ ìŒì‹ì„ ì¶”ê°€í•˜ì„¸ìš”</p>";

					}
					for (i = 0; i < result.length; i++) {
						temp += `<a href="#none" onclick="fnIngreInfo('${result[i].ingre_seq}')" class="btn mb-1 waves-effect waves-light btn-rounded btn-outline-primary">${result[i].ingre_name}</a> &nbsp;&nbsp;&nbsp;&nbsp;`;
					}
					$("#fridgeInfo").html(temp);
				}
			})
			.fail((res, error, status) => {
				console.log(error)
			})
	}

	// ì˜ì–‘ ì„±ë¶„
	function fnIngreInfo(ingre_seq) {
		$("#nutritionInfoPlaceholder").hide(); 		// ì•ˆë‚´ê¸€ ì‚­ì œ
		$("#ingreInfoDetail").show();  					// ì˜ì–‘ì •ë³´ í‘œì‹œ
		$.ajax({
			url: "/index/nutrition/" + ingre_seq,
			data: {ingre_seq: ingre_seq},
			dataType: "json",
			method: "post"
		})
			.done((res) => {
				if (res.result == "success") {
					let ingreData = res.resultDto;
					// ê°€ì ¸ì˜¨ ì¬ë£Œì˜ ì˜ì–‘ ì •ë³´ë¥¼ ë³€ìˆ˜ì— ì €ì¥
					let proteinValue = ingreData.ingre_pro;
					let carbValue = ingreData.ingre_car;
					let fatValue = ingreData.ingre_fat;

					$("#ingreName").html(ingreData.ingre_name + " ì˜ ì˜ì–‘ ì •ë³´");
					$("#ingrePro").html(proteinValue + " g");
					$("#ingreCar").html(carbValue + " g");
					$("#ingreFat").html(fatValue + " g");

					// ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸
					nutritionChart.data.datasets[0].data = [proteinValue, carbValue, fatValue];
					nutritionChart.update();
				}
			})
			.fail((res, error, status) => {
				console.log(error);
			});

	}
	// ì°¨íŠ¸ ìŠ¤í¬ë¦½íŠ¸
	// ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ë‹¨ë°±ì§ˆ, íƒ„ìˆ˜í™”ë¬¼, ì§€ë°© ê°’
	const proteinValue = 0; // ë‹¨ë°±ì§ˆ ê°’
	const carbValue = 0; // íƒ„ìˆ˜í™”ë¬¼ ê°’
	const fatValue = 0; // ì§€ë°© ê°’

	// ì°¨íŠ¸ ë°ì´í„° ì„¤ì •
	let data = {
		datasets: [{
			data: [proteinValue, carbValue, fatValue],
			backgroundColor: ['#aec0f5', '#ABCDEF', '#5e7ad6'],
		}],
		labels: ['ë‹¨ë°±ì§ˆ', 'íƒ„ìˆ˜í™”ë¬¼', 'ì§€ë°©'],
	};

	// ì°¨íŠ¸ ê·¸ë¦¬ê¸°
	let ctx = document.getElementById("nutritionChart").getContext('2d');
	let nutritionChart = new Chart(ctx, {
		type: 'pie',
		data: data,
		options: {
			legend: {
				display: false // ë ˆì´ë¸” ìˆ¨ê¸°ê¸°
			}
		},
	});

	// í”„ë¡œê·¸ë˜ìŠ¤ë°”
	function updateProgressBar() {
		const progressBar = $("#progressbar");
		const progressBarStatus = $("#progressbarStatus");

		$.ajax({
			url: "/index/progressbar",
			data: {mem_seq: mem_seq},
			dataType: "json",
			method: "post"
		})
			.done((res) => {
				console.log(res);
				if (res.f_status === "ë¹„ì›€") {
					progressBar.css("width", "100%");
					progressBar.removeClass("bg-danger bg-warning bg-success");
					progressBar.addClass("bg-empty");
					progressBarStatus.html("ëƒ‰ì¥ê³ ê°€ ë¹„ì—ˆìŠµë‹ˆë‹¤");
				}

				else if (res.f_status === "ì–‘í˜¸") {
					progressBar.css("width", "25%");
					progressBar.removeClass("bg-empty bg-danger bg-warning");
					progressBar.addClass("bg-success");
					progressBarStatus.html("ì–‘í˜¸");
				}

				else if (res.f_status === "ë³´í†µ") {
					progressBar.css("width", "50%");
					progressBar.removeClass("bg-empty bg-danger bg-success");
					progressBar.addClass("bg-warning");
					progressBarStatus.html("ë³´í†µ");
				}

				else {
					progressBar.css("width", "75%");
					progressBar.removeClass("bg-empty bg-warning bg-success");
					progressBar.addClass("bg-danger");
					progressBarStatus.html("ìœ„í—˜");
				}
			})
			.fail((res, error, status) => {
				console.log(error);
			});
	}

</script>