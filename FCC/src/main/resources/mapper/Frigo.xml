<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Frigo">
	 <insert id="Frigo_insert" parameterType="FrigoDto">
		INSERT INTO TB_FRIGO
		(
			frigo_seq
			,mem_seq
			,ingre_seq
			,frigo_expiration
			,frigo_storage
			,frigo_wdate
		)
		VALUES (
			SEQ_FRIGO.nextval
			, #{mem_seq}
			, #{ingre_seq}
			, #{frigo_expiration}
			, #{frigo_storage}
			, sysdate
		)
		<selectKey keyProperty="frigo_seq" resultType="long" order="AFTER">
			SELECT SEQ_FRIGO.currval FROM dual
		</selectKey>	
	</insert>
	
	<select id="Frigo_getInsertResult" parameterType="long" resultType="FrigoDto">
		SELECT
			A.frigo_seq
			,A. FROM TB_FRIGO A WHERE frigo_seq = #{frigo_seq}
	</select>

	<select id="Frigo_getList" resultType="FrigoResponseDto">
		SELECT FRI.FRIGO_SEQ, ING.INGRE_NAME, ING.INGRE_DETAIL, TO_CHAR(FRI.FRIGO_EXPIRATION, 'YY/MM/DD') FRIGO_EXPIRATION, FRI.FRIGO_STORAGE, TO_CHAR(FRI.FRIGO_WDATE, 'YY/MM/DD') FRIGO_WDATE, 
			CASE
				WHEN (TO_DATE(FRI.FRIGO_EXPIRATION, 'YY/MM/DD') - TO_DATE(FRI.FRIGO_WDATE, 'YY/MM/DD')) <![CDATA[<]]> 0 THEN '초과'
				WHEN (TO_DATE(FRI.FRIGO_EXPIRATION, 'YY/MM/DD') - TO_DATE(FRI.FRIGO_WDATE, 'YY/MM/DD')) = 0 THEN 'D-Day'
				ELSE 'D-'||TO_CHAR(TO_DATE(FRI.FRIGO_EXPIRATION, 'YY/MM/DD') - TO_DATE(FRI.FRIGO_WDATE, 'YY/MM/DD'))
			END AS ddayBadge
		FROM TB_FRIGO FRI, TB_INGRE ING
		WHERE FRI.INGRE_SEQ = ING.INGRE_SEQ 
		AND MEM_SEQ = #{mem_seq}
		AND FRI.FRIGO_STORAGE = #{frigo_storage}
	</select>
	
</mapper>